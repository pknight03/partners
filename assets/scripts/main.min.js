"use strict";function getPrimaryStats(primaryhash){var url="http://osmstats.redcross.org/hashtags/"+primaryhash+"/users";$.getJSON(url,function(hashtagData){for(var usersCount=Object.keys(hashtagData).length,editsCount=0,buildingCount=0,roadCount=0,i=0;i<usersCount;i++)editsCount+=hashtagData[i].edits,buildingCount+=hashtagData[i].buildings,roadCount+=hashtagData[i].roads;roadCount=Math.round(roadCount),$("#stats-roadCount").html(roadCount.toLocaleString()),$("#stats-buildingCount").html(buildingCount.toLocaleString()),$("#stats-usersCount").html(usersCount.toLocaleString()),$("#stats-editsCount").html(editsCount.toLocaleString())})}function getProjects(projects){$(".Projects-slider").flexslider({animation:"slide",directionNav:!0,slideshowSpeed:6e6,prevText:"",nextText:'<i class="ico icon collecticon-chevron-right"></i>'}),$(".flex-next").prependTo(".HOT-Nav-Projects"),$(".flex-control-nav").prependTo(".HOT-Nav-Projects"),$(".flex-prev").prependTo(".HOT-Nav-Projects"),1===projects.length&&$(".flex-next").css("display","none"),projects.forEach(function(project,i){var url="http://tasks.hotosm.org/project/"+project+".json";$.getJSON(url,function(projectData){makeProject(projectData,i+2)}).fail(function(err){console.warn("WARNING >> Project #"+project+" could not be accessed at "+url+".\nThe server returned the following message object:",err),makePlaceholderProject(project,i+2)})})}function makeProject(project,projectOrder){var props=project.properties,projDone=Math.round(props.done+props.validated);$("ul li:nth-child("+projectOrder+") .HOT-Progress").addClass("projWidth"+projectOrder),$(".HOT-Progress").append("<style>.projWidth"+projectOrder+":before{ width: "+projDone+"%;}</style>"),$("ul li:nth-child("+projectOrder+") .HOT-Title p").html("<b>"+project.id+" - "+props.name+"</b>"),$("ul li:nth-child("+projectOrder+") .HOT-Progress").html("<p>"+projDone+"%</p>"),$("ul li:nth-child("+projectOrder+") .HOT-Map").attr("id","Map-"+project.id),addMap(project.id)}function makePlaceholderProject(projectId,projectOrder){$("ul li:nth-child("+projectOrder+") .HOT-Title p").html('<i class="ico icon collecticon-sign-danger"></i>\n<b>HOT Project #'+projectId+" Not Active/Not Found in HOT Tasking Manager</b>"),$("#TM-Contribute-Btn-"+projectId).css("display","none"),$("#HOT-Title-"+projectId+" p").css("width","100%");var ghIssueTitle="HOT Tasking Manager endpoint failure in "+PT.mainHashtag+" partner page",ghIssueBody="Project "+projectId+" is no longer indexed in the HOT\n Tasking Manager, so it should be removed from the "+PT.mainHashtag+" partner\n page variable settings.",errorHtml='Uh oh, it looks like <a href="http://tasks.hotosm.org/project/'+projectId+'"\n target="_blank">Project #'+projectId+'</a> has been removed from the HOT Tasking Manager.\n <a href="https://github.com/MissingMaps/partners/issues/new?title='+ghIssueTitle+"\n &body="+ghIssueBody+'" target="_blank">Click here</a> to report an issue or\n <a href="http://tasks.hotosm.org/" target="_blank">here</a>\n to search for more projects.';$("ul li:nth-child("+projectOrder+") .HOT-Description p").html(errorHtml),$("ul li:nth-child("+projectOrder+") .HOT-Map").empty().addClass("placeholder"),$("ul li:nth-child("+projectOrder+") .HOT-Progress ").css("display","none")}function onEachFeature(feature,layer){var symbology={color:"black",weight:.25,opacity:.7,fillOpacity:.4,fillColor:"black"},state=feature.properties.state;state===-1?symbology.fillColor="#dfdfdf":0===state?symbology.fillColor="#dfdfdf":1===state?symbology.fillColor="#dfdfdf":2===state?symbology.fillColor="#ffa500":3===state&&(symbology.fillColor="#008000"),layer.setStyle(symbology)}function addMap(projectId){var endpoint="http://tasks.hotosm.org/project/"+projectId+"/tasks.json";$.getJSON(endpoint,function(taskData){$("#Map-"+projectId).empty();var map=L.map("Map-"+projectId,{zoomControl:!1}).setView([38.889931,-77.009003],13);L.tileLayer(mbBasemapUrl+"?access_token="+mbToken,{attribution:'<a href="http://mapbox.com">Mapbox</a>'}).addTo(map),map.attributionControl.setPrefix("");var featureLayer=L.geoJson(taskData,{onEachFeature:onEachFeature}).addTo(map);map.fitBounds(featureLayer.getBounds()),map.dragging.disable(),map.touchZoom.disable(),map.doubleClickZoom.disable(),map.scrollWheelZoom.disable(),map.keyboard.disable(),map.tap&&map.tap.disable()})}function eventsFunctionality(){var eventsCount=$(".event-sub-container").length,firstTwoOpen=!1,allOpen=!1;0===eventsCount&&$(".events-null").css("display","block"),eventsCount<3&&$(".events-btn").css("display","none"),$(".events-btn").bind("click").click(function(event){firstTwoOpen===!1&&allOpen===!1?(firstTwoOpen=!0,$(".hidden").slice(0,2).css("display","block").animate({opacity:1,height:"190px"},500),eventsCount>=5?$(".events-btn").html("SEE ALL"):(firstTwoOpen=!1,allOpen=!0,$(".events-btn").html("SEE FEWER"))):firstTwoOpen===!0&&allOpen===!1&&eventsCount>2?(firstTwoOpen=!1,allOpen=!0,$(".events-btn").html("SEE ALL"),$(".hidden").css("display","block").animate({opacity:1,height:"190px"},500),$(".events-btn").html("SEE FEWER")):firstTwoOpen===!1&&allOpen===!0&&(firstTwoOpen=!1,allOpen=!1,$(".hidden").animate({opacity:0,height:"0px"},300,function(){$(".hidden").css("display","none")}),$(".events-btn").html("SEE MORE"))})}function setupGraphs(){function removeExistingGraphs(){var totalGraph=document.querySelector("#Team-User-Total-Graph svg"),bldngGraph=document.querySelector("#Team-User-Bldng-Graph svg"),roadsGraph=document.querySelector("#Team-User-Roads-Graph svg");totalGraph.parentNode.removeChild(totalGraph),bldngGraph.parentNode.removeChild(bldngGraph),roadsGraph.parentNode.removeChild(roadsGraph)}var moreBtn=$(".btn.invert-btn-grn.teams-btn"),teamLabel=$(".Team-Graph-Title .left"),teamUserLabel=$(".Team-User-Graph-Title .left");$("#Select-Users-Graph").click(function(){$("#Select-Teams-Graph").removeClass("Selected"),$("#Select-Users-Graph").addClass("Selected"),teamLabel.text("Users"),teamUserLabel.text("Users"),moreBtn.animate({opacity:0},500,function(){moreBtn.css("display","none")}),removeExistingGraphs(),getUserActivityStats(PT.mainHashtag)}),$("#Select-Teams-Graph").click(function(){$("#Select-Users-Graph").removeClass("Selected"),$("#Select-Teams-Graph").addClass("Selected"),teamLabel.text("Teams"),teamUserLabel.text("Teams"),PT.subHashtags.length>10&&moreBtn.css("display","inline").animate({opacity:1},500),removeExistingGraphs(),getGroupActivityStats(PT.subHashtags)})}function generateUserUrl(userName,userId){var userUrl="http://www.missingmaps.org/users/#/"+userId;return'<a xlink:href="'+userUrl+'" target="_blank" style="text-decoration:none">'+userName+"</a>"}function getUserActivityStats(hashtag){var url="http://osmstats.redcross.org/top-users/"+hashtag;$.getJSON(url,function(userData){var totalSum=Object.keys(userData).map(function(user){var totalEdits=Math.round(Number(userData[user].all_edits));return{name:generateUserUrl(user,userData[user].user_number),value:totalEdits}}).sort(function(a,b){return b.value-a.value}),bldngSum=Object.keys(userData).map(function(user){var bldngEdits=Math.round(Number(userData[user].buildings));return{name:generateUserUrl(user,userData[user].user_number),value:bldngEdits}}).sort(function(a,b){return b.value-a.value}),roadsSum=Object.keys(userData).map(function(user){var roadsEdits=Math.round(Number(userData[user].road_kms));return{name:generateUserUrl(user,userData[user].user_number),value:roadsEdits}}).sort(function(a,b){return b.value-a.value}),c1=new Barchart(totalSum,"#Team-User-Total-Graph"),c2=new Barchart(bldngSum,"#Team-User-Bldng-Graph"),c3=new Barchart(roadsSum,"#Team-User-Roads-Graph");d3.select(window).on("resize",function(){c1.resize(),c2.resize(),c3.resize()})})}function generateHashtagUrl(hashtag){var hashtagUrl="http://www.missingmaps.org/leaderboards/#/"+hashtag;return'<a xlink:href="'+hashtagUrl+'" target="_blank" style="text-decoration: none">#'+hashtag+"</a>"}function getGroupActivityStats(hashtags){var hashtagsString=hashtags.join(","),url="http://osmstats.redcross.org/group-summaries/"+hashtagsString;$.getJSON(url,function(hashtagData){if($.isEmptyObject(hashtagData))$(".Team-User-Container").css("display","none"),console.warn("WARNING >> None of the secondary hashtags contain any metrics according to the Missing Maps endpoint at https://osmstats.redcross.org/group-summaries/"+hashtagsString+". The partner graphs will not be displayed.");else{var totalSum=hashtags.reduce(function(acc,ht){var vals=hashtagData[ht];if(!$.isEmptyObject(vals)){var sum=Math.round(Number(vals.building_count_add)+Number(vals.building_count_mod)+Number(vals.road_count_add)+Number(vals.road_count_mod)+Number(vals.waterway_count_add)+Number(vals.poi_count_add));acc.push({name:generateHashtagUrl(ht),value:sum})}return acc},[]).sort(function(a,b){return b.value-a.value}),bldngSum=hashtags.reduce(function(acc,ht){var vals=hashtagData[ht];if(!$.isEmptyObject(vals)){var sum=Math.round(Number(vals.building_count_add)+Number(vals.building_count_mod));acc.push({name:generateHashtagUrl(ht),value:sum})}return acc},[]).sort(function(a,b){return b.value-a.value}),roadsSum=hashtags.reduce(function(acc,ht){var vals=hashtagData[ht];if(!$.isEmptyObject(vals)){var sum=Math.round(Number(vals.road_km_add)+Number(vals.road_km_mod));acc.push({name:generateHashtagUrl(ht),value:sum})}return acc},[]).sort(function(a,b){return b.value-a.value}),c1=new Barchart(totalSum,"#Team-User-Total-Graph"),c2=new Barchart(bldngSum,"#Team-User-Bldng-Graph"),c3=new Barchart(roadsSum,"#Team-User-Roads-Graph");d3.select(window).on("resize",function(){c1.resize(),c2.resize(),c3.resize()})}})}function Barchart(data,targetElement){var margin={top:0,right:0,bottom:0,left:0},width=parseInt(d3.select(targetElement).style("width"),10);width=width-margin.left-margin.right;var height=220,barPadding=60/data.length,barHeight=(height-margin.top-margin.bottom)/data.length-barPadding;data.length>10&&!function(){barPadding=6,barHeight=(height-margin.top-margin.bottom)/10-barPadding,height+=(barPadding+barHeight)*(data.length-10);var offset=-((data.length-10)*(barPadding+barHeight))-12,expanded=!1;$(".teams-btn").css("display","initial").click(function(){var graphs=$(".Team-User-Graph > svg");expanded===!1?($(".teams-btn").html("SHOW INITIAL TEAMS"),graphs.animate({marginTop:offset},300),expanded=!0):expanded===!0&&($(".teams-btn").html("SHOW MORE TEAMS"),graphs.animate({marginTop:0},300),expanded=!1)})}();var x=d3.scale.linear().range([0,width]).domain([0,d3.max(data,function(d){return d.value})]),chart=d3.select(targetElement).append("svg").style("width",width+margin.left+margin.right+"px").style("height",height+"px").append("g").attr("transform","translate("+[margin.left,margin.top]+")");d3.select(chart.node().parentNode).style("height",height+"px");var bars=chart.selectAll(".bar").data(data).enter().append("g").attr("class","bar").attr("transform",function(d,i){return"translate(0,"+i*(barHeight+barPadding)+")"});bars.append("rect").attr("class","bars").attr("height",barHeight).attr("width",function(d){return x(d.value)}),bars.append("text").attr("class","Graph-Label-Name").attr("x",5).attr("y",barHeight/2).attr("dy",".35em").html(function(d){return d.name}).style("fill","#606161"),bars.append("text").attr("class","Graph-Label-Value").attr("x",width-20).attr("y",barHeight/2).attr("dy",".35em").text(function(d){return d.value.toLocaleString()}).attr("text-anchor","end").style("fill","#606161"),this.resize=function(){width=parseInt(d3.select(targetElement).style("width"),10),width=width-margin.left-margin.right,d3.select(targetElement).select("svg").style("width",width+margin.left+margin.right+"px"),x.range([0,width]),chart.selectAll("rect.bars").attr("width",function(d){return x(d.value)}),chart.selectAll("text.Graph-Label-Value").attr("x",width-20)}}function getImgs(flickrApiKey,flickrSetId){var URL="https://api.flickr.com/services/rest/?method=flickr.photosets.getPhotos&api_key="+flickrApiKey+"&photoset_id="+flickrSetId+"&privacy_filter=1&format=json&nojsoncallback=1";$.getJSON(URL,function(data){$.each(data.photoset.photo,function(i,item){var imgSrc="https://farm"+item.farm+".staticflickr.com/"+item.server+"/"+item.id+"_"+item.secret+".jpg",imgThumb=$("<li><img src="+imgSrc+"></img></li>");$(".flickr-hit li").length<30&&$(imgThumb).appendTo(".flickr-hit")}),$(".flexslider").flexslider({controlNav:!0,directionNav:!0,slideshowSpeed:6e3,prevText:'<i class="ico icon collecticon-chevron-left"></i>',nextText:'<i class="ico icon collecticon-chevron-right"></i>'}),$(".photo-width-fix ol").prependTo(".Community-Navigation")})}function checkHashtags(hashtags){hashtags.length<2&&(console.warn("WARNING >> There are not enough secondary hashtags listed in order to represent differences in contribution level between partners. The partner graphs will not be displayed."),$(".Team-User-Container").css("display","none"))}var mbToken="pk.eyJ1IjoiZGV2c2VlZCIsImEiOiJnUi1mbkVvIn0.018aLhX0Mb0tdtaT2QNe2Q",mbBasemapUrl="https://api.mapbox.com/v4/mapbox.light/{z}/{x}/{y}.png";getPrimaryStats(PT.mainHashtag),getProjects(PT.hotProjects),eventsFunctionality(),checkHashtags(PT.subHashtags),setupGraphs(),getGroupActivityStats(PT.subHashtags),getImgs(PT.flickrApiKey,PT.flickrSetId);
//# sourceMappingURL=main.min.js.map